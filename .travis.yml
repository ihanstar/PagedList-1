language: csharp
dist: trusty
sudo: required
mono: latest #Sadly, we need mono to push our NuGet package to the server.
dotnet: 1.0.0-preview2-003131

script:
  - dotnet restore
  - dotnet build */**/project.json --configuration Release
  - dotnet test tests/**/project.json --configuration Release
  
before_deploy:
  - mkdir -p .nuget
  - wget -O .nuget/nuget.exe https://dist.nuget.org/win-x86-commandline/latest/nuget.exe
  - chmod 755 .nuget/nuget.exe
  
deploy:
  on:
   branch: master
  provider: script
  skip_cleanup: true
  script:
     - dotnet pack src/*/ --no-build --configuration Release && mono .nuget/nuget.exe push src/*/bin/Release/**.nupkg -apikey $NUGET_API_KEY -Source https://www.nuget.org/api/v2/package -verbosity detailed
