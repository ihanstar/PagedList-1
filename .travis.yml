language: csharp
dist: trusty
sudo: required
mono: latest #Sadly, we need mono to push our NuGet package to the server.
dotnet: 1.0.0-preview2-003131

script:
  - dotnet restore
  - dotnet build */**/project.json --configuration Release
  - dotnet test tests/**/project.json --configuration Release
  
before_deploy:
  - mkdir -p .nuget
  - wget -O .nuget/nuget.exe https://dist.nuget.org/win-x86-commandline/latest/nuget.exe
  - chmod 755 .nuget/nuget.exe
  
deploy:
  on:
   branch: release #We only want to deploy a new NuGet package when we push to the release branch
  provider: script
  skip_cleanup: true
  script:
     chmod ugo+x ./deploy.sh && ./deploy.sh
